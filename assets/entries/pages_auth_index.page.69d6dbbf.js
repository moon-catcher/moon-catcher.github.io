import{r as n,j as c}from"../chunks/chunk-9a4f56c2.js";import{a as g,b as m,L as w,G as N,c as p,d as _,g as f,e as G,f as k,s as S,C as l,h as C,i as x,j as O,k as A}from"../chunks/chunk-ea45e243.js";import{L as j}from"../chunks/chunk-58d52d78.js";const y=async(r,t)=>{const i=`/authenticate/${r}/${t}`;return await g.get(i,{withCredentials:!0})};function U(){const{setToken:r}=m(),[t,i]=n.useState(""),[a,I]=n.useState(""),[u,L]=n.useState(""),[d,o]=n.useState(w);return n.useEffect(()=>{const s=new URL(window.location.href).searchParams,E=s.get("code"),T=s.get("state"),e=s.get("error");i(E??""),I(T??""),L(e??"")},[]),n.useEffect(()=>{u&&(window.opener=void 0,o(u===N?p:_),setTimeout(()=>{window.close()},1e3))},[u]),n.useEffect(()=>{const s=f(O),E=f(A),T=G().add(3,"day").toDate().toUTCString();if(console.log(t,s,a,s,"**************"),t&&s!==t&&E===a)o(k),y(t,a).then(async({data:e})=>{if(e!=null&&e.token){S(O,t,{expires:T}),localStorage.setItem(l,JSON.stringify(e.authkey)),r(e.token),o(C);const h=window.opener[`${a}`];window.opener=void 0,setTimeout(()=>{h(e.token)},1e3)}}).catch(e=>{e.message!=="Request aborted"&&(o(_),setTimeout(()=>{window.close()},1e3))});else if(t&&t===s){const e=f(l);o(e?C:x)}},[t,r,a]),c.jsxs(c.Fragment,{children:[c.jsx("span",{children:d}),c.jsx(j,{href:"/blog",children:"返回首页"})]})}export{U as Page};
