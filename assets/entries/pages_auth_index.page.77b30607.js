import{r as c,j as i}from"../chunks/chunk-9a4f56c2.js";import{a as I,u as L,L as m,G as N,b as h,c as l,g as u,d as p,e as d,s as G,C as T,f as C,h as w,i as _,j as x}from"../chunks/chunk-a851f0d2.js";import{u as k,L as A}from"../chunks/chunk-92eeb2d5.js";const j=async(n,s)=>{const t=`/authenticate/${n}/${s}`;return await I.get(t,{withCredentials:!0})};function D(){const n=k();console.log(n.routeParams,"pageContext");const{code:s,state:t,error:a}=n.routeParams??{};console.log(s,t,a,"code, state, error");const{setToken:E}=L(),[g,o]=c.useState(m);return c.useEffect(()=>{a&&(window.opener=void 0,o(a===N?h:l),setTimeout(()=>{window.close()},1e3))},[a]),c.useEffect(()=>{const r=u(_),f=u(x),O=p().add(3,"day").toDate().toUTCString();if(console.log(s,r,t,r,"**************"),s&&r!==s&&f===t)o(d),j(s,t).then(async({data:e})=>{console.log(e,"data"),e!=null&&e.token&&(G(_,s,{expires:O}),localStorage.setItem(T,JSON.stringify(e.authkey)),E(e.token),o(C),window.opener[`${t}`](e.token),window.opener=void 0)}).catch(e=>{e.message!=="Request aborted"&&(console.error(e.message),o(l),setTimeout(()=>{window.close()},1e3))});else if(s&&s===r){const e=u(T);o(e?C:w)}},[s,E,t]),i.jsxs(i.Fragment,{children:[i.jsx("span",{children:g}),i.jsx(A,{href:"/blog",children:"返回首页"})]})}export{D as Page};
