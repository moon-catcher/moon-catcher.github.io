import{r as n,j as c}from"../chunks/chunk-9a4f56c2.js";import{a as h,b as g,L as w,G as N,c as m,d as _,g as T,e as p,f as G,s as k,C,h as O,i as S,j as l,k as x}from"../chunks/chunk-bce179bd.js";import{L as A}from"../chunks/chunk-9a368f19.js";const j=async(a,t)=>{const i=`/authenticate/${a}/${t}`;return await h.get(i,{withCredentials:!0})};function X(){const{setToken:a}=g(),[t,i]=n.useState(""),[r,I]=n.useState(""),[u,L]=n.useState(""),[d,o]=n.useState(w);return n.useEffect(()=>{const s=new URL(window.location.href).searchParams,E=s.get("code"),f=s.get("state"),e=s.get("error");i(E??""),I(f??""),L(e??"")},[]),n.useEffect(()=>{u&&(window.opener=void 0,o(u===N?m:_),setTimeout(()=>{window.close()},1e3))},[u]),n.useEffect(()=>{const s=T(l),E=T(x),f=p().add(3,"day").toDate().toUTCString();if(console.log(t,s,r,s,"**************"),t&&s!==t&&E===r)o(G),j(t,r).then(async({data:e})=>{e!=null&&e.token&&(k(l,t,{expires:f}),localStorage.setItem(C,JSON.stringify(e.authkey)),a(e.token),o(O),window.opener[`${r}`](e.token),window.opener=void 0)}).catch(e=>{e.message!=="Request aborted"&&(o(_),setTimeout(()=>{window.close()},1e3))});else if(t&&t===s){const e=T(C);o(e?O:S)}},[t,a,r]),c.jsxs(c.Fragment,{children:[c.jsx("span",{children:d}),c.jsx(A,{href:"/blog",children:"返回首页"})]})}export{X as Page};
