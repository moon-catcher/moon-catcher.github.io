import{r,j as a}from"../chunks/chunk-9a4f56c2.js";import{g}from"../chunks/chunk-b6ef1873.js";import{u as N,L as h,G as p,a as w,b as T,g as u,d as G,c as k,s as S,C as _,e as m,f as x,h as O,i as A}from"../chunks/chunk-2c409e9d.js";import{L as K}from"../chunks/chunk-d209e026.js";import"../chunks/chunk-10a2ec28.js";function b(){const{setToken:f}=N(),[t,I]=r.useState(""),[n,L]=r.useState(""),[c,l]=r.useState(""),[C,o]=r.useState(h);return r.useEffect(()=>{const s=new URL(window.location.href).searchParams,i=s.get("code"),E=s.get("state"),e=s.get("error");I(i??""),L(E??""),l(e??"")},[]),r.useEffect(()=>{c&&(window.opener=void 0,o(c===p?w:T),setTimeout(()=>{window.close()},1e3))},[c]),r.useEffect(()=>{const s=u(O),i=u(A),E=G().add(3,"day").toDate().toUTCString();if(console.log(t,s,n,s,"**************"),t&&s!==t&&i===n)o(k),g(t,n).then(async({data:e})=>{if(e!=null&&e.token){S(O,t,{expires:E}),localStorage.setItem(_,JSON.stringify(e.authkey)),f(e.token),o(m);const d=window.opener[`${n}`];window.opener=void 0,setTimeout(()=>{d(e.token)},1e3)}}).catch(e=>{e.message!=="Request aborted"&&(o(T),setTimeout(()=>{window.close()},1e3))});else if(t&&t===s){const e=u(_);o(e?m:x)}},[t,f,n]),a.jsxs(a.Fragment,{children:[a.jsx("span",{children:C}),a.jsx(K,{href:"/blog",children:"返回首页"})]})}export{b as Page};
