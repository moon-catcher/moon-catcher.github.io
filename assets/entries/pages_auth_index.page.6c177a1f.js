import{r as n,j as c}from"../chunks/chunk-9a4f56c2.js";import{a as m,u as g,L as w,G as N,b as p,c as _,g as f,d as G,e as k,s as S,C as l,f as C,h as x,i as O,j as A}from"../chunks/chunk-23847d0a.js";import{L as j}from"../chunks/chunk-d209e026.js";import"../chunks/chunk-10a2ec28.js";const y=async(a,t)=>{const i=`/authenticate/${a}/${t}`;return await m.get(i,{withCredentials:!0})};function b(){const{setToken:a}=g(),[t,i]=n.useState(""),[r,I]=n.useState(""),[u,L]=n.useState(""),[d,o]=n.useState(w);return n.useEffect(()=>{const s=new URL(window.location.href).searchParams,E=s.get("code"),T=s.get("state"),e=s.get("error");i(E??""),I(T??""),L(e??"")},[]),n.useEffect(()=>{u&&(window.opener=void 0,o(u===N?p:_),setTimeout(()=>{window.close()},1e3))},[u]),n.useEffect(()=>{const s=f(O),E=f(A),T=G().add(3,"day").toDate().toUTCString();if(console.log(t,s,r,s,"**************"),t&&s!==t&&E===r)o(k),y(t,r).then(async({data:e})=>{if(e!=null&&e.token){S(O,t,{expires:T}),localStorage.setItem(l,JSON.stringify(e.authkey)),a(e.token),o(C);const h=window.opener[`${r}`];window.opener=void 0,setTimeout(()=>{h(e.token)},1e3)}}).catch(e=>{e.message!=="Request aborted"&&(o(_),setTimeout(()=>{window.close()},1e3))});else if(t&&t===s){const e=f(l);o(e?C:x)}},[t,a,r]),c.jsxs(c.Fragment,{children:[c.jsx("span",{children:d}),c.jsx(j,{href:"/blog",children:"返回首页"})]})}export{b as Page};
