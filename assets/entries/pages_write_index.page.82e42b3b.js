import{_ as S}from"../chunks/chunk-cf010ec4.js";import{R as A,r as t,j as e}from"../chunks/chunk-9a4f56c2.js";import{u as R,d as E}from"../chunks/chunk-2c409e9d.js";import{O}from"../chunks/chunk-053f14ea.js";import{a as N}from"../chunks/chunk-b6ef1873.js";const H={icon:">>",children:"empty",title:"title"},P=A.createContext(void 0),D=({accordionContext:l,children:n})=>e.jsx(P.Provider,{value:l,children:n}),B=()=>{const l=t.useContext(P);if(!l)throw new Error("AccordionContext Error");return l},L=t.memo(function(n){const[u,d]=t.useState(!1);return e.jsx("div",{className:"accordion",children:e.jsx(D,{accordionContext:[u,d],children:n.children})})}),M=t.memo(function(n){const[u,d]=t.useState(!n.defaultClose),h=t.useRef(null),a=t.useRef(null),o=t.useRef(null),r=t.useRef(null),[m,j]=t.useState("unset"),[f,p]=t.useState("unset"),[b,C]=B(),v=t.useCallback(i=>{r.current=setTimeout(()=>{var x;(x=h.current)==null||x.style.setProperty(O,`${i*.1}`),i&&v(i-1)},30)},[]);t.useEffect(()=>{function i(k){k.target instanceof HTMLDivElement&&k.target.className==="collapse-box"&&C(!1)}function x(k){var w;!((w=h.current)!=null&&w.getElementsByClassName("collapse-box")[0].contains(k.target))&&!r.current&&v(15)}return window.addEventListener("transitionend",i),window.addEventListener("mouseover",x),()=>{window.removeEventListener("transitionend",i),window.removeEventListener("mouseover",x)}},[v,C]),t.useEffect(()=>{function i(){a.current&&j(a.current.clientHeight)}function x(){o.current&&p(o.current.offsetHeight)}a.current&&new ResizeObserver(i).observe(a.current),o.current&&new ResizeObserver(x).observe(o.current)},[n.children]);const s=i=>{var x;C(!0),d(k=>!k),(x=n.onClick)==null||x.call(n,i)},c=()=>{var i;r.current&&(clearTimeout(r.current),r.current=null),(i=h.current)==null||i.style.setProperty(O,"1.5")};return t.useEffect(()=>{},[]),e.jsxs("div",{ref:h,className:"collapse",style:{flexShrink:Number(m)<50?0:1},children:[e.jsxs("div",{onClick:s,className:"collapse-header",children:[e.jsx("div",{children:n.icon}),e.jsx("div",{children:n.title})]}),e.jsx("div",{className:"collapse-box",onMouseOver:c,ref:o,style:{height:u?m:0,overflow:b?"hidden":"auto",transition:n.noTransition?void 0:"height 0.05s linear"},children:e.jsx("div",{className:"collapse-child",ref:a,children:n.children})})]})}),g=Object.assign(L,{Collapse:Object.assign(M,{defaultProps:H})}),F=t.createContext(void 0),_=l=>{const{files:n,setFileContent:u,setTitle:d}=l,{userInfo:h,login:a,octokit:o}=R(),r=t.useRef(new Map),[m,j]=t.useState({remoteDraft:!0,localDraft:!0,published:!1}),[f,p]=t.useState();t.useEffect(()=>{if(f&&o&&(d(f.path),f)){if(r.current.has(f.path))return;N(o,{owner:"moon-catcher",path:f.path}).then(s=>{if(console.log(s.data,"res"),s.data instanceof Array)r.current.set(f.path,s.data);else{const c=s.data;u(atob(c.content??""))}})}},[f,o]),t.useEffect(()=>{n.length&&(p(n[0]),r.current.set("",n))},[n]);const b=t.useCallback((s,c)=>{j(i=>({...i,[s]:c}))},[]),C=t.useCallback(s=>{p(s),u(atob(s.content??""))},[]),v=t.useCallback(s=>{p(s)},[]);return e.jsx("div",{className:["FilePicker",l.open?"filepicker-show":"filepicker-hidden"].join(" "),children:e.jsxs("div",{className:"filepicker-box",children:[e.jsxs("div",{className:"filepicker-header",children:[e.jsx("div",{className:"filepicker-tab",onClick:l.onFilePickerOpenChange,children:"Articles"}),e.jsx("div",{className:"filepicker-footer",children:e.jsxs("div",{className:"checkbox-group",children:[e.jsx("input",{type:"checkbox",id:"filepicker-remote-draft",checked:m.remoteDraft,onChange:s=>b("remoteDraft",s.target.checked)}),e.jsx("label",{htmlFor:"filepicker-remote-draft",className:"check-button",children:"在线草稿"}),e.jsx("input",{type:"checkbox",id:"filepicker-published",checked:m.published,onChange:s=>b("published",s.target.checked)}),e.jsx("label",{htmlFor:"filepicker-published",className:"check-button",children:"已发布"})]})})]}),e.jsx("div",{className:"filepicker-draft-box",children:e.jsxs(g,{children:[m.remoteDraft&&e.jsx(F.Provider,{value:r.current,children:e.jsx(T,{path:"",title:"在线草稿",handleDirClick:v,handleFileClick:C})}),m.published&&e.jsx(g.Collapse,{title:"已发布",children:"已发布"})]})})]})})},z=t.memo(_),T=l=>{const{handleFileClick:n,handleDirClick:u,title:d,path:h}=l,a=t.useContext(F),o=(a==null?void 0:a.get(h))??[];return e.jsx(g.Collapse,{title:d,children:o.map(r=>r.type==="file"?e.jsx("div",{onClick:()=>n==null?void 0:n(r),children:r.name},r.path):e.jsx(g,{children:e.jsx(T,{path:r.path,title:r.name,handleDirClick:u,handleFileClick:n})},r.path))})};const I=t.lazy(()=>S(()=>import("../chunks/chunk-5ad101ef.js"),["assets/chunks/chunk-5ad101ef.js","assets/chunks/chunk-9a4f56c2.js","assets/static/index.fcfe032f.css"])),y="YYYY/MM/DD HH:mm:ss";function Q(){const l=t.useRef(null),{userInfo:n,login:u,octokit:d}=R(),[h,a]=t.useState(E().format(y)),[o,r]=t.useState(!1),[m,j]=t.useState(),[f,p]=t.useState(""),[b,C]=t.useState([]);t.useEffect(()=>(l.current=setTimeout(()=>{a(E().format(y))},1e3),()=>{l.current&&clearTimeout(l.current)}),[h]),t.useEffect(()=>{d&&n.login&&N(d,{owner:"moon-catcher"}).then(s=>{const c=s.data;c==null||c[0],C(c)})},[d,n]),t.useEffect(()=>{const s=c=>{console.log(c,"event"),c.ctrlKey&&c.key==="e"&&(c.preventDefault(),r(i=>!i))};return window.addEventListener("keydown",s),()=>{window.removeEventListener("keydown",s)}},[]);const v=t.useCallback(()=>{r(s=>!s)},[]);return t.useCallback(s=>{const{target:{value:c}}=s;p(c)},[]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"header",children:[e.jsx(z,{files:b,open:o,setTitle:p,setFileContent:j,onFilePickerOpenChange:v}),e.jsx("button",{onClick:v,children:"展开"}),e.jsx("div",{children:f}),e.jsxs("div",{className:"author",children:["author: ",n.name??e.jsx("span",{onClick:u,children:"未登录"}),`  |       ${h}`]})]}),e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"editor-content",style:{width:o?"calc(100% - 300px)":"100%",right:o?"-150px":"0px"},children:"Loading..."}),children:e.jsx(I,{className:"editor-content",style:{width:o?"calc(100% - 300px)":"100%",right:o?"-150px":"0px"},value:m,onChange:j})})]})}export{Q as Page};
