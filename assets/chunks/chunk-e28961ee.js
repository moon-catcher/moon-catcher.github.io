function Ee(){return!(typeof process>"u"||!process.cwd||!process.versions||typeof process.versions.node>"u"||!process.release||process.release.name!=="node")}function U(e,t){let n;{var r=Error.stackTraceLimit;Error.stackTraceLimit=1/0,n=new Error(e),Error.stackTraceLimit=r}return Ee()&&(n.stack=we(n.stack,t)),n}function we(e,t){if(!e)return e;const n=Re(e);let r=0;return n.filter(o=>o.includes(" (internal/")||o.includes(" (node:internal")?!1:r<t&&ve(o)?(r++,!1):!0).join(`
`)}function ve(e){return e.startsWith("    at ")}function Re(e){return e.split(/\r?\n/)}function L(e,t){const n=globalThis.__vite_plugin_ssr=globalThis.__vite_plugin_ssr||{};return n[e]=n[e]||t}function v(e){return typeof e=="object"&&e!==null}function B(e){return Array.from(new Set(e))}const w=L("assertPackageInstances.ts",{instances:[],alreadyLogged:new Set}),ie="The client runtime of Server Routing as well as the client runtime of Client Routing are both being loaded. Make sure they aren't loaded both at the same time for a given page. See https://vite-plugin-ssr.com/client-runtimes-conflict",H="Two vite-plugin-ssr client runtime instances are being loaded. Make sure your client-side bundles don't include vite-plugin-ssr twice. (In order to reduce the size of your client-side JavaScript bundles.)";function G(){{const e=B(w.instances);if(e.length>1){const t=`Both vite-plugin-ssr@${e[0]} and vite-plugin-ssr@${e[1]} loaded. Only one version should be loaded.`;Se(!1,t)}}w.checkSingleInstance&&w.instances.length>1&&F(!1,H,{onlyOnce:!0,showStackTrace:!0})}function Nt(e){F(w.isClientRouting!==!0,ie,{onlyOnce:!0,showStackTrace:!0}),F(w.isClientRouting===void 0,H,{onlyOnce:!0,showStackTrace:!0}),w.isClientRouting=!1,e&&(w.checkSingleInstance=!0),G()}function zt(e){F(w.isClientRouting!==!1,ie,{onlyOnce:!0,showStackTrace:!0}),F(w.isClientRouting===void 0,H,{onlyOnce:!0,showStackTrace:!0}),w.isClientRouting=!0,e&&(w.checkSingleInstance=!0),G()}function be(e){w.instances.push(e),G()}function Se(e,t){if(e)return;const n=`[vite-plugin-ssr][Wrong Usage] ${t}`;throw new Error(n)}function F(e,t,{onlyOnce:n,showStackTrace:r}){if(e)return;const s=`[vite-plugin-ssr][Warning] ${t}`;if(n){const{alreadyLogged:o}=w,a=n===!0?s:n;if(o.has(a))return;o.add(a)}console.warn(r?new Error(s):s)}const Pe="0.4.140",$={projectName:"vite-plugin-ssr",projectVersion:Pe,npmPackageName:"vite-plugin-ssr",githubRepository:"https://github.com/brillout/vite-plugin-ssr"};be($.projectVersion);const oe=new Proxy(e=>e,{get:()=>oe}),P=oe,m=L("utils/assert.ts",{alreadyLogged:new Set,logger(e,t){t==="info"?console.log(e):console.warn(e)},showStackTraceList:new WeakSet}),$e=`[${$.npmPackageName}]`,Te=`[${$.npmPackageName}@${$.projectVersion}]`,M=2;function i(e,t){var o;if(e)return;const n=(()=>{if(!t)return null;const a=typeof t=="string"?t:"`"+JSON.stringify(t)+"`";return`Debug info (this is for the ${$.projectName} maintainers; you can ignore this): ${a}`})();let r=[`You stumbled upon a bug in ${$.projectName}'s source code.`,`Go to ${$.githubRepository}/issues/new and copy-paste this error; a maintainer will fix the bug (usually under 24 hours).`,n].filter(Boolean).join(" ");r=I(r),r=W(r,"Bug"),r=x(r,!0);const s=U(r,M);throw(o=m.onBeforeLog)==null||o.call(m),s}function p(e,t,{showStackTrace:n}={}){var s;if(e)return;t=I(t),t=W(t,"Wrong Usage"),t=x(t);const r=U(t,M);throw n&&m.showStackTraceList.add(r),(s=m.onBeforeLog)==null||s.call(m),r}function _e(e){return e=I(e),e=W(e,"Error"),e=x(e),U(e,M)}function T(e,t,{onlyOnce:n,showStackTrace:r}){var s;if(!e){if(t=I(t),t=W(t,"Warning"),t=x(t),n){const{alreadyLogged:o}=m,a=n===!0?t:n;if(o.has(a))return;o.add(a)}if((s=m.onBeforeLog)==null||s.call(m),r){const o=new Error(t);m.showStackTraceList.add(o),m.logger(o,"warn")}else m.logger(t,"warn")}}function Vt(e,t,{onlyOnce:n}){var r;if(!e){if(t=I(t),t=x(t),n){const{alreadyLogged:s}=m,o=t;if(s.has(o))return;s.add(o)}(r=m.onBeforeLog)==null||r.call(m),m.logger(t,"info")}}function W(e,t){let n=`[${t}]`;const r=t==="Warning"?"yellow":"red";return n=P.bold(P[r](n)),`${n}${e}`}function I(e){return e.startsWith("[")?e:` ${e}`}function x(e,t=!1){return`${t?Te:$e}${e}`}function J(){return typeof window<"u"&&typeof window.scrollY=="number"}const j=L("utils/assertRouterType.ts",{});function Ut(){ae(Le()),j.isClientRouting=!0}function Le(){return j.isClientRouting!==!1}function Bt(){ae(j.isClientRouting!==!0),j.isClientRouting=!1}function ae(e){p(J(),"`import { something } from 'vite-plugin-ssr/client/router'` is forbidden on the server-side",{showStackTrace:!0}),T(e,"You shouldn't `import { something } from 'vite-plugin-ssr/client/router'` when using Server Routing. The 'vite-plugin-ssr/client/router' utilities work only with Client Routing. In particular, don't `import { navigate }` nor `import { prefetch }` as they unnecessarily bloat your client-side bundle.",{showStackTrace:!0,onlyOnce:!0})}const Fe=["js","ts","cjs","cts","mjs","mts","jsx","tsx","cjsx","ctsx","mjsx","mtsx"],le=["vue","svelte","marko","md","mdx"],Ie=[...Fe,...le];function ce(e){const t=Ie.some(n=>e.endsWith("."+n));return i(!xe(e)||t),t}function xe(e){return/\.(c|m)?(j|t)sx?$/.test(e)}function Oe(e){return le.some(t=>e.endsWith("."+t))}function k(e,t,n){return typeof e=="string"?X(e.split(""),t,n).join(""):X(e,t,n)}function X(e,t,n){const r=[];let s=t>=0?t:e.length+t;i(s>=0&&s<=e.length);let o=n>=0?n:e.length+n;for(i(o>=0&&o<=e.length);!(s===o||(s===e.length&&(s=0),s===o));){const a=e[s];i(a!==void 0),r.push(a),s++}return r}function ue(e){return e.startsWith("/")||e.startsWith("http")||e.startsWith("tauri://")||e.startsWith(".")||e.startsWith("?")||e.startsWith("#")||e===""}function Ht(e,t){i(t.includes(" but ")),p(typeof e=="string",`${t} should be a string`),!ue(e)&&(!e.startsWith("/")&&!e.includes(":")?p(!1,`${t} is '${e}' and it should be '/${e}' instead (URL pathnames should start with a leading slash)`):p(!1,`${t} isn't a valid URL`))}function je(e,t){i(ue(e),{url:e}),i(t.startsWith("/"),{url:e,baseServer:t});const[n,...r]=e.split("#");i(n!==void 0);const s=["",...r].join("#")||null;i(s===null||s.startsWith("#"));const o=s===null?"":N(s.slice(1)),[a,...l]=n.split("?");i(a!==void 0);const c=["",...l].join("?")||null;i(c===null||c.startsWith("?"),{url:e,searchOriginal:c});const u={},h={};Array.from(new URLSearchParams(c||"")).forEach(([b,K])=>{u[b]=K,h[b]=[...h[b]||[],K]});const{origin:f,pathnameResolved:E}=Ce(a,t);i(f===null||f===N(f),{origin:f}),i(E.startsWith("/"),{url:e,pathnameResolved:E}),i(f===null||e.startsWith(f),{url:e,origin:f});const g=a.slice((f||"").length);Ne(e,f,g,c,s);let{pathname:y,hasBaseServer:R}=De(E,t);return y=ke(y),i(y.startsWith("/")),{origin:f,pathname:y,pathnameOriginal:g,hasBaseServer:R,search:u,searchAll:h,searchOriginal:c,hash:o,hashOriginal:s}}function N(e){try{return decodeURIComponent(e)}catch{}try{return decodeURI(e)}catch{}return e}function ke(e){return e.split("/").map(t=>N(t).split("/").join("%2F")).join("/")}function Ce(e,t){var l;if(e.startsWith("//"))return{origin:null,pathnameResolved:e};let n=!1;const r="tauri://",s="http://";e.startsWith(r)&&(n=!0,e=s+e.slice(r.length));let o,a;try{const c=new URL(e);o=c.origin,a=c.pathname}catch{o=null;let u=typeof window<"u"&&((l=window==null?void 0:window.document)==null?void 0:l.baseURI);u=u||"http://fake.example.org"+t,a=new URL(e,u).pathname}return a||(a="/"),n&&(i(o),i(o.startsWith(s)),o=r+o.slice(s.length)),i(a.startsWith("/"),{urlWithoutSearch:e,pathnameResolved:a}),i(a===a.split("?")[0].split("#")[0]),{origin:o,pathnameResolved:a}}function We(e){i(e.startsWith("/")),i(!e.includes("?")),i(!e.includes("#"))}function De(e,t){We(e),i(Ae(t));let n=e;if(i(n.startsWith("/")),i(t.startsWith("/")),t==="/")return{pathname:e,hasBaseServer:!0};let r=t;return t.endsWith("/")&&n===k(t,0,-1)&&(r=k(t,0,-1),i(n===r)),n.startsWith(r)?(i(n.startsWith("/")||n.startsWith("http")),i(n.startsWith(r)),n=n.slice(r.length),n.startsWith("/")||(n="/"+n),i(n.startsWith("/")),{pathname:n,hasBaseServer:!0}):{pathname:e,hasBaseServer:!1}}function Ae(e){return e.startsWith("/")}function Ne(e,t,n,r,s){const o=ze(t,n,r,s);i(e===o,{url:e,urlRecreated:o})}function ze(e,t,n,r){return`${e||""}${t}${n||""}${r||""}`}function Y(e,t){Object.defineProperties(e,Object.getOwnPropertyDescriptors(t))}function D(e){return e instanceof Function||typeof e=="function"}function Gt(e){return(t,n)=>{const r=e(t),s=e(n);return r===s?0:r>s?-1:1}}function Ve(e){return(t,n)=>{const r=e(t),s=e(n);if(i([!0,!1,null].includes(r)),i([!0,!1,null].includes(s)),r===s)return 0;if(r===!0||s===!1)return-1;if(s===!0||r===!1)return 1;i(!1)}}function Ue(e){return Ve(t=>{const n=e(t);return n===null?null:!n})}function d(e,t,n="unknown"){if(!v(e))return!1;if(!(t in e))return n==="undefined";if(n==="unknown")return!0;const r=e[t];return n==="array"?Array.isArray(r):n==="object"?v(r):n==="string[]"?Array.isArray(r)&&r.every(s=>typeof s=="string"):n==="function"?D(r):Array.isArray(n)?typeof r=="string"&&n.includes(r):n==="null"?r===null:n==="undefined"?r===void 0:n==="true"?r===!0:n==="false"?r===!1:typeof r===n}function Be(e,t){return e.toLowerCase()<t.toLowerCase()?-1:e.toLowerCase()>t.toLowerCase()?1:0}const He=e=>e!=null;function fe(e){const t=n=>`Not a posix path: ${n}`;i(e!==null,t("null")),i(typeof e=="string",t(`typeof path === '${typeof e}'`)),i(e!=="",t("(empty string)")),i(e),i(!e.includes("\\"),t(e))}const Ge=["$$registrations","_rerender_only"],Me=[".md",".mdx"];function Je(e,t){Ye(e,t,!0)}function Ye(e,t,n){const s=Object.keys(e).filter(l=>!Ge.includes(l)),o=s.filter(l=>l!=="default"),a=s.includes("default");if(o.length===0){if(a)return;i(s.length===0),p(!1,`${t} doesn't export any value, but it should have a \`export default\` instead`)}else if(!Me.some(l=>t.endsWith(l))){const l=o.join(", ");n?T(o.length===0,`${t} should only have a default export: remove \`export { ${l} }\``,{onlyOnce:!0}):T(o.length===0,`${t} replace \`export { ${l} }\` with \`export default { ${l} }\``,{onlyOnce:!0})}}function qe(e){return Object.entries(e)}const Ke=["clientRouting"];function Xe(e){Ke.forEach(t=>{if(i(e.fileExports),!(t in e.fileExports))return;const n=`The value of \`${t}\` is only allowed to be \`true\`.`;p(e.fileExports[t]!==!1,`${e.filePath} has \`export { ${t} }\` with the value \`false\` which is prohibited: remove \`export { ${t} }\` instead. (${n})`),p(e.fileExports[t]===!0,`${e.filePath} has \`export { ${t} }\` with a forbidden value. ${n}`)})}const de=["render","clientRouting","prerender","doNotPrerender"];function Qe(e,t){p(!de.includes(e),`${t} has \`export default { ${e} }\` which is prohibited, use \`export { ${e} }\` instead.`)}function Ze(e,t){const n={},r={},s={};if(e.forEach(l=>{et(l).forEach(({exportName:u,exportValue:h,isFromDefaultExport:f})=>{i(u!=="default"),s[u]=s[u]??[],s[u].push({exportValue:h,exportSource:`${l.filePath} > ${f?`\`export default { ${u} }\``:`\`export { ${u} }\``}`,filePath:l.filePath,_filePath:l.filePath,_fileType:l.fileType,_isFromDefaultExport:f})})}),t){const{configValues:l}=t;qe(l).forEach(([c,u])=>{const h=t.configElements[c];i(h);const{configDefinedByFile:f,configDefinedAt:E}=h;i(f),r[c]=r[c]??u,n[c]=n[c]??[],i(n[c].length===0),n[c].push({configValue:u,configDefinedAt:E,configDefinedByFile:f});const g=c;s[g]=s[g]??[],s[g].push({exportValue:u,exportSource:E,filePath:f,_filePath:f,_fileType:null,_isFromDefaultExport:null})})}const o=tt(),a={};return Object.entries(s).forEach(([l,c])=>{c.forEach(({exportValue:u,_fileType:h,_isFromDefaultExport:f})=>{a[l]=a[l]??u,h===".page"&&!f&&(l in o||(o[l]=u))})}),i(!("default"in a)),i(!("default"in s)),{config:r,configEntries:n,exports:a,exportsAll:s,pageExports:o}}function et(e){const{filePath:t,fileExports:n}=e;i(n),i(ce(t));const r=[];return Object.entries(n).sort(Ue(([s])=>s==="default")).forEach(([s,o])=>{let a=s==="default";if(a)if(Oe(t))s="Page";else{p(v(o),`The \`export default\` of ${t} should be an object.`),Object.entries(o).forEach(([l,c])=>{Qe(l,t),r.push({exportName:l,exportValue:c,isFromDefaultExport:a})});return}r.push({exportName:s,exportValue:o,isFromDefaultExport:a})}),r.forEach(({exportName:s,isFromDefaultExport:o})=>{i(!(o&&de.includes(s)))}),r}function tt(){return new Proxy({},{get(...e){return J()||T(!1,"`pageContext.pageExports` is outdated. Use `pageContext.exports` instead, see https://vite-plugin-ssr.com/exports",{onlyOnce:!0,showStackTrace:!0}),Reflect.get(...e)}})}function nt(e){const t=".page.",n=k(e.split(t),0,-1).join(t);return i(!n.includes("\\")),n}function _(e){fe(e)}function Mt(e,t){if(t.length>0){const r=t.filter(s=>s.isErrorPage);return r.length===0?null:(p(r.length===1,"Only one error page can be defined"),r[0].pageId)}const n=B(e.map(({pageId:r})=>r).filter(r=>A(r)));if(p(n.length<=1,`Only one _error.page.js is allowed, but found several: ${n.join(" ")}`),n.length>0){const r=n[0];return i(r),r}return null}function A(e,t){return i(!e.includes("\\")),e.includes("/_error")}function rt(e,t){if(t.length>0){const n=t.find(r=>r.pageId===e);return i(n),n.isErrorPage}else return A(e)}const st=[".page",".page.server",".page.route",".page.client",".css"];function it(e){if(fe(e),e.endsWith(".css"))return".css";i(ce(e),e);const n=e.split("/").slice(-1)[0].split("."),r=n.slice(-3)[0],s=n.slice(-2)[0];if(s==="page")return".page";if(i(r==="page",e),s==="server")return".page.server";if(s==="client")return".page.client";if(s==="route")return".page.route";i(!1,e)}function ge(e){const t=o=>s.pageId===o||s.isDefaultPageFile&&(Q(s.filePath)||ot(o,s.filePath)),n=it(e),s={filePath:e,fileType:n,isEnv:o=>{if(i(n!==".page.route"),o==="CLIENT_ONLY")return n===".page.client"||n===".css";if(o==="SERVER_ONLY")return n===".page.server";if(o==="CLIENT_AND_SERVER")return n===".page";i(!1)},isRelevant:t,isDefaultPageFile:z(e),isRendererPageFile:n!==".css"&&z(e)&&Q(e),isErrorPageFile:A(e),pageId:nt(e)};return s}function z(e){return _(e),A(e)?!1:e.includes("/_default")}function Q(e){return _(e),e.includes("/renderer/")}function ot(e,t){_(e),_(t),i(!e.endsWith("/")),i(!t.endsWith("/")),i(z(t));const n=k(t.split("/"),0,-1).filter(r=>r!=="_default").join("/");return e.startsWith(n)}function at(e){i(Array.isArray(e)||e===null),i(e!==null),e.forEach(t=>{i(v(t)),i(d(t,"pageId","string")),i(d(t,"routeFilesystem","string")||d(t,"routeFilesystem","null")),i(d(t,"routeFilesystemDefinedBy","string")||d(t,"routeFilesystemDefinedBy","null")),i(d(t,"loadCodeFiles","function")),i(d(t,"isErrorPage","boolean")),i(d(t,"configElements","object")),he(t.configElements,!1)})}function lt(e){he(e,!0)}function he(e,t){i(v(e)),Object.entries(e).forEach(([n,r])=>{if(i(v(r)||r===null),r===null){i(t);return}i(d(r,"configDefinedAt","string")),i(d(r,"plusConfigFilePath","string")||d(r,"plusConfigFilePath","null")),i(d(r,"configEnv","string")),i(d(r,"codeFilePath","string")||d(r,"codeFilePath","null")),i(d(r,"codeFileExport","string")||d(r,"codeFileExport","null")),i(d(r,"configValueSerialized","string")||d(r,"configValueSerialized","undefined")),(t||n==="route")&&i(d(r,"configValue")||d(r,"configValueSerialized"))})}const ct=[{is:e=>e===void 0,match:e=>e==="!undefined",serialize:()=>"!undefined",deserialize:()=>{}},{is:e=>e===1/0,match:e=>e==="!Infinity",serialize:()=>"!Infinity",deserialize:()=>1/0},{is:e=>e===-1/0,match:e=>e==="!-Infinity",serialize:()=>"!-Infinity",deserialize:()=>-1/0},{is:e=>typeof e=="number"&&isNaN(e),match:e=>e==="!NaN",serialize:()=>"!NaN",deserialize:()=>NaN},{is:e=>e instanceof Date,match:e=>e.startsWith("!Date:"),serialize:e=>"!Date:"+e.toISOString(),deserialize:e=>new Date(e.slice(6))},{is:e=>typeof e=="bigint",match:e=>e.startsWith("!BigInt:"),serialize:e=>"!BigInt:"+e.toString(),deserialize:e=>{if(typeof BigInt>"u")throw new Error("Your JavaScript environement does not support BigInt. Consider adding a polyfill.");return BigInt(e.slice(8))}},{is:e=>e instanceof RegExp,match:e=>e.startsWith("!RegExp:"),serialize:e=>"!RegExp:"+e.toString(),deserialize:e=>{e=e.slice(8);const t=e.match(/\/(.*)\/(.*)?/),n=t[1],r=t[2];return new RegExp(n,r)}},{is:e=>e instanceof Map,match:e=>e.startsWith("!Map:"),serialize:(e,t)=>"!Map:"+t(Array.from(e.entries())),deserialize:(e,t)=>new Map(t(e.slice(5)))},{is:e=>e instanceof Set,match:e=>e.startsWith("!Set:"),serialize:(e,t)=>"!Set:"+t(Array.from(e.values())),deserialize:(e,t)=>new Set(t(e.slice(5)))},{is:e=>typeof e=="string"&&e.startsWith("!"),match:e=>e.startsWith("!"),serialize:e=>"!"+e,deserialize:e=>e.slice(1)}];function q(e){const t=JSON.parse(e);return pe(t)}function pe(e){return typeof e=="string"?ut(e):(typeof e=="object"&&e!==null&&Object.entries(e).forEach(([t,n])=>{e[t]=pe(n)}),e)}function ut(e){for(const{match:t,deserialize:n}of ct)if(t(e))return n(e,q);return e}function ft(e){e.forEach(t=>{Object.entries(t.configElements).forEach(([n,r])=>{dt(r),n==="route"&&gt(r)})})}function dt(e){const{configValueSerialized:t}=e;t!==void 0&&(e.configValue=q(t))}function gt(e){i(d(e,"configValue"));const{configValue:t}=e,n=typeof t;p(n==="string"||D(t),`${e.configDefinedAt} has an invalid type '${n}': it should be a string or a function instead, see https://vite-plugin-ssr.com/route`)}function ht(e){i(d(e,"isGeneratedFile")),i(e.isGeneratedFile!==!1,"vite-plugin-ssr was re-installed(/re-built). Restart your app."),i(e.isGeneratedFile===!0,`\`isGeneratedFile === ${e.isGeneratedFile}\``),i(d(e,"pageFilesLazy","object")),i(d(e,"pageFilesEager","object")),i(d(e,"pageFilesExportNamesLazy","object")),i(d(e,"pageFilesExportNamesEager","object")),i(d(e.pageFilesLazy,".page")),i(d(e.pageFilesLazy,".page.client")||d(e.pageFilesLazy,".page.server")),i(d(e,"pageFilesList","string[]")),i(d(e,"pageConfigs")),i(d(e,"pageConfigGlobal"));const{pageConfigs:t,pageConfigGlobal:n}=e;at(t),ft(t),lt(n);const r={};O(e.pageFilesLazy).forEach(({filePath:o,pageFile:a,globValue:l})=>{a=r[o]=r[o]??a;const c=l;Z(c),a.loadFile=async()=>{"fileExports"in a||(a.fileExports=await c(),Xe(a))}}),O(e.pageFilesExportNamesLazy).forEach(({filePath:o,pageFile:a,globValue:l})=>{a=r[o]=r[o]??a;const c=l;Z(c),a.loadExportNames=async()=>{if(!("exportNames"in a)){const u=await c();p("exportNames"in u,"You seem to be using Vite 2 but the latest vite-plugin-ssr versions only work with Vite 3"),i(d(u,"exportNames","string[]"),a.filePath),a.exportNames=u.exportNames}}}),O(e.pageFilesEager).forEach(({filePath:o,pageFile:a,globValue:l})=>{a=r[o]=r[o]??a;const c=l;i(v(c)),a.fileExports=c}),O(e.pageFilesExportNamesEager).forEach(({filePath:o,pageFile:a,globValue:l})=>{a=r[o]=r[o]??a;const c=l;i(v(c)),i(d(c,"exportNames","string[]"),a.filePath),a.exportNames=c.exportNames}),e.pageFilesList.forEach(o=>{r[o]=r[o]??ge(o)});const s=Object.values(r);return s.forEach(({filePath:o})=>{i(!o.includes("\\"))}),{pageFiles:s,pageConfigs:t,pageConfigGlobal:n}}function O(e){const t=[];return Object.entries(e).forEach(([n,r])=>{i(st.includes(n)),i(v(r)),Object.entries(r).forEach(([s,o])=>{const a=ge(s);i(a.fileType===n),t.push({filePath:s,pageFile:a,globValue:o})})}),t}function Z(e){i(D(e))}const S=L("setPageFiles.ts",{});function Jt(e){const{pageFiles:t,pageConfigs:n,pageConfigGlobal:r}=ht(e);S.pageFilesAll=t,S.pageConfigs=n,S.pageConfigGlobal=r}async function Yt(e,t){e?(i(!S.pageFilesGetter),i(t===void 0)):(i(S.pageFilesGetter),i(typeof t=="boolean"),(!S.pageFilesAll||!t)&&await S.pageFilesGetter());const{pageFilesAll:n,pageConfigs:r,pageConfigGlobal:s}=S;i(n&&r&&s);const o=pt(n,r);return{pageFilesAll:n,allPageIds:o,pageConfigs:r,pageConfigGlobal:s}}function pt(e,t){const n=e.filter(({isDefaultPageFile:o})=>!o).map(({pageId:o})=>o),r=B(n),s=t.map(o=>o.pageId);return[...r,...s]}function mt(e,t){return me(e,t,!0)}function qt(e,t){return me(e,t,!1)}function me(e,t,n){const r=n?"CLIENT_ONLY":"SERVER_ONLY",s=e.filter(g=>g.isRelevant(t)&&g.fileType!==".page.route").sort(yt(n,t)),o=g=>{const y=s.filter(b=>b.pageId===t&&b.isEnv(g?"CLIENT_AND_SERVER":r));p(y.length<=1,`Merge the following files into a single file: ${y.map(b=>b.filePath).join(" ")}`);const R=y[0];return i(R===void 0||!R.isDefaultPageFile),R},a=o(!1),l=o(!0),c=g=>s.filter(y=>y.isRendererPageFile&&y.isEnv(g?"CLIENT_AND_SERVER":r))[0],u=c(!1),h=c(!0),f=s.filter(g=>g.isDefaultPageFile&&!g.isRendererPageFile&&(g.isEnv(r)||g.isEnv("CLIENT_AND_SERVER")));return[a,l,...f,u,h].filter(He)}function yt(e,t){const n=e?"CLIENT_ONLY":"SERVER_ONLY",r=-1,s=1,o=0;return(a,l)=>{if(!a.isDefaultPageFile&&l.isDefaultPageFile)return r;if(!l.isDefaultPageFile&&a.isDefaultPageFile)return s;{const c=a.isRendererPageFile,u=l.isRendererPageFile;if(!c&&u)return r;if(!u&&c)return s;i(c===u)}{const c=ee(t,a.filePath),u=ee(t,l.filePath);if(c<u)return r;if(u<c)return s;i(c===u)}{if(a.isEnv(n)&&l.isEnv("CLIENT_AND_SERVER"))return r;if(l.isEnv(n)&&a.isEnv("CLIENT_AND_SERVER"))return s}return o}}function ee(e,t){_(e),_(t);let n=0;for(;n<e.length&&n<t.length&&e[n]===t[n];n++);const r=e.slice(n),s=t.slice(n),o=r.split("/").length,a=s.split("/").length;return o+a}function Et(){i(J())}function wt(){Et()}function te(e){const t=e/1e3;if(t<120){const n=ne(t);return`${n} second${re(n)}`}{const n=t/60,r=ne(n);return`${r} minute${re(r)}`}}function ne(e){let t=e.toFixed(1);return t.endsWith(".0")&&(t=t.slice(0,-2)),t}function re(e){return e==="1"?"":"s"}const vt=L("utils/executeHook.ts",{userHookErrors:new Map});function Rt(e,t,n){const{timeoutErr:r,timeoutWarn:s}=bt(t);let o,a;const l=new Promise((f,E)=>{o=g=>{c(),f(g)},a=g=>{c(),E(g)}}),c=()=>{clearTimeout(u),clearTimeout(h)},u=setTimeout(()=>{T(!1,`The ${t}() hook defined by ${n} is taking more than ${te(s)}`,{onlyOnce:!1})},s),h=setTimeout(()=>{const f=_e(`Hook timeout: the ${t}() hook defined by ${n} didn't finish after ${te(r)}`);a(f)},r);return(async()=>{try{const f=await e();o(f)}catch(f){v(f)&&vt.userHookErrors.set(f,{hookName:t,hookFilePath:n}),a(f)}})(),l}function bt(e){return e==="onBeforeRoute"?{timeoutErr:5*1e3,timeoutWarn:1*1e3}:e==="onBeforePrerender"?{timeoutErr:10*60*1e3,timeoutWarn:30*1e3}:{timeoutErr:40*1e3,timeoutWarn:4*1e3}}function Kt(e){const t=window.location.href,{searchOriginal:n,hashOriginal:r,pathname:s}=je(t,"/");let o;return e!=null&&e.withoutHash?o=`${s}${n||""}`:o=`${s}${n||""}${r||""}`,i(o.startsWith("/")),o}wt();function Xt(){const e="vite-plugin-ssr_pageContext",t=document.getElementById(e);p(t,`The element #${e} (which vite-plugin-ssr automatically injects into the HTML) is missing from the DOM. This may happen if your HTML is malformed. Make sure your HTML isn't malformed, and make sure you don't remove #${e} from the HTML nor from the DOM.`);const n=t.textContent;i(n);const r=q(n);return i(d(r,"_pageId","string")),Y(r,{_hasPageContextFromServer:!0}),r}function V(e,t){if(!(t in e.exports))return null;const n=e.exports[t],r=e.exportsAll[t][0];if(i(r.exportValue===n),n===null)return null;const s=r.exportSource;return i(s),i(!t.endsWith(")")),p(D(n),`hook ${t}() defined by ${s} should be a function`),{hookFn:n,hookName:t,hookFilePath:s}}function Qt(e,t){V(e,t)}function St(e){const t=Object.entries(e);for(const n in e)delete e[n];t.sort(([n],[r])=>Be(n,r)).forEach(([n,r])=>{e[n]=r})}function Pt(e){$t(e),Tt(e)}function $t(e){rt(e._pageId,e._pageConfigs)&&i(d(e,"is404","boolean"))}function Tt(e){if(e.is404===void 0||e.is404===null)return;const t=e.pageProps||{};if(!v(t)){T(!1,"pageContext.pageProps should be an object",{showStackTrace:!0,onlyOnce:!0});return}t.is404=t.is404||e.is404,e.pageProps=t}const _t="not-serializable",C=L("getPageContextProxyForUser.ts",{});function Lt(e){return i([!0,!1].includes(e._hasPageContextFromServer)),i([!0,!1].includes(e._hasPageContextFromClient)),new Proxy(e,{get(t,n){const r=e[n],s=JSON.stringify(n);return p(r!==_t,`pageContext[${s}] couldn't be serialized and, therefore, is missing on the client-side. Check the server logs for more information.`),Ft(e,n,`pageContext[${s}] isn't available on the client-side because ${s} is missing in passToClient, see https://vite-plugin-ssr.com/passToClient`),r}})}function Ft(e,t,n){C.prev===t||C.prev==="__v_raw"||(Ot(t),!(t in e)&&(xt(t)||e._hasPageContextFromServer&&!e._hasPageContextFromClient&&p(!1,n)))}const It=["then","toJSON"];function xt(e){return!!(It.includes(e)||typeof e=="symbol"||typeof e!="string"||e.startsWith("__v_"))}function Ot(e){C.prev=e,window.setTimeout(()=>{C.prev=void 0},0)}function jt(e,t){if(t){const s=e;i([!0,!1].includes(s.isHydration)),i([!0,!1,null].includes(s.isBackwardNavigation))}else{const s=e;i(s.isHydration===!0),i(s.isBackwardNavigation===null)}i("config"in e),i("configEntries"in e),i("exports"in e),i("exportsAll"in e),i("pageExports"in e),i(v(e.pageExports));const n=e.exports.Page;Y(e,{Page:n}),kt(e),St(e);const r=Lt(e);return Pt(e),r}function kt(e){Object.entries(e).forEach(([t,n])=>{delete e[t],e[t]=n})}function Ct(e,t){const n=e.filter(s=>s.pageId===t);return i(n.length<=1),n[0]??null}async function Wt(e,t){const n={};return!t&&"configValues"in e||((await e.loadCodeFiles()).forEach(s=>{const{configName:o,codeFilePath:a}=s;if(s.isPlusFile){const{codeFileExports:l}=s;o!=="client"&&Je(l,a),Object.entries(l).forEach(([c,u])=>{const h=c!=="default",f=h?c:s.configName,E=u;if(n[f]=E,se(E,f,a),h){const g=e.configElements[s.configName];i(g),e.configElements[f]={configValue:E,codeFileExport:c,codeFilePath:a,configDefinedByFile:a,configDefinedAt:`${P.bold(a)} > ${P.cyan(`export { ${c} }`)}`,configEnv:g.configEnv,plusConfigFilePath:null}}})}else{const l=s.codeFileExportValue;n[o]=l,se(l,o,a)}}),Object.entries(e.configElements).map(([s,o])=>{o.codeFilePath||(n[s]=o.configValue)}),Y(e,{configValues:n})),e}function se(e,t,n){i(!n.includes("+config.")),p(e!==null,`Set ${P.cyan(t)} to ${P.cyan("null")} in a ${P.bold("+config.js")} file instead of ${P.bold(n)}`)}const ye="__whileFetchingAssets";async function Zt(e,t,n){const r=mt(e,n),s=Ct(t,n);let o;const a=!1;try{o=(await Promise.all([s&&Wt(s,a),...r.map(y=>{var R;return(R=y.loadFile)==null?void 0:R.call(y)})]))[0]}catch(g){throw Dt(g)&&Object.assign(g,{[ye]:!0}),g}const{config:l,configEntries:c,exports:u,exportsAll:h,pageExports:f}=Ze(r,o);return{config:l,configEntries:c,exports:u,exportsAll:h,pageExports:f,_pageFilesLoaded:r}}function en(e){return e?e[ye]===!0:!1}function Dt(e){return e instanceof Error?["Failed to fetch dynamically imported module","error loading dynamically imported module","Importing a module script failed","error resolving module specifier","failed to resolve module"].some(n=>e.message.toLowerCase().includes(n.toLowerCase())):!1}async function tn(e,t){const n=jt(e,t);let r=null,s;r=V(e,"render"),s="render";{const l=V(e,"onRenderClient");l&&(r=l,s="onRenderClient")}if(!r){const l=At(e);if(e._pageConfigs.length>0)p(!1,`No onRenderClient() hook defined for URL '${l}', but it's needed, see https://vite-plugin-ssr.com/onRenderClient`);else{const c=e._pageFilesLoaded.filter(h=>h.fileType===".page.client");let u;c.length===0?u="No file `*.page.client.*` found for URL "+l:u="One of the following files should export a `render()` hook: "+c.map(h=>h.filePath).join(" "),p(!1,u)}}i(r);const o=r.hookFn;i(s);const a=await Rt(()=>o(n),s,r.hookFilePath);p(a===void 0,`The ${s}() hook defined by ${r.hookFilePath} isn't allowed to return a value`)}function At(e){let t;try{t=e.urlPathname??e.urlOriginal}catch{}return t=t??window.location.href,t}export{k as A,V as B,Rt as C,Vt as D,Mt as E,jt as F,q as G,_e as H,A as I,Ae as J,mt as K,Ct as L,ue as M,Le as N,en as O,zt as P,Xt as a,p as b,Yt as c,T as d,Bt as e,Nt as f,Kt as g,tn as h,Qt as i,D as j,Et as k,Zt as l,Ut as m,v as n,Y as o,L as p,qt as q,i as r,Jt as s,J as t,je as u,P as v,Ve as w,Gt as x,d as y,Ht as z};
