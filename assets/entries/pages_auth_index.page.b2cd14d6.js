import{r as n,j as i}from"../chunks/chunk-9a4f56c2.js";import{a as h,u as g,L as m,G as w,b as N,c as _,g as T,d as p,e as G,s as S,C,f as O,h as k,i as l,j as x}from"../chunks/chunk-c9b4f9f8.js";import{L as A}from"../chunks/chunk-2b26b7f1.js";import"../chunks/chunk-24dec1b5.js";const j=async(a,t)=>{const c=`/authenticate/${a}/${t}`;return await h.get(c,{withCredentials:!0})};function U(){const{setToken:a}=g(),[t,c]=n.useState(""),[r,I]=n.useState(""),[u,L]=n.useState(""),[d,o]=n.useState(m);return n.useEffect(()=>{const s=new URL(window.location.href).searchParams,E=s.get("code"),f=s.get("state"),e=s.get("error");c(E??""),I(f??""),L(e??"")},[]),n.useEffect(()=>{u&&(window.opener=void 0,o(u===w?N:_),setTimeout(()=>{window.close()},1e3))},[u]),n.useEffect(()=>{const s=T(l),E=T(x),f=p().add(3,"day").toDate().toUTCString();if(console.log(t,s,r,s,"**************"),t&&s!==t&&E===r)o(G),j(t,r).then(async({data:e})=>{e!=null&&e.token&&(S(l,t,{expires:f}),localStorage.setItem(C,JSON.stringify(e.authkey)),a(e.token),o(O),window.opener[`${r}`](e.token),window.opener=void 0)}).catch(e=>{e.message!=="Request aborted"&&(o(_),setTimeout(()=>{window.close()},1e3))});else if(t&&t===s){const e=T(C);o(e?O:k)}},[t,a,r]),i.jsxs(i.Fragment,{children:[i.jsx("span",{children:d}),i.jsx(A,{href:"/blog",children:"返回首页"})]})}export{U as Page};
